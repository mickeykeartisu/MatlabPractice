% fragment to calculate ERB smoothed P/AP spectrum%  30/May/2001 by Hideki Kawaharaevv=(0:1024)/1024*HzToERBrate(fs/2); % ERB axis for smoothingeew=1; % effective smoothing width in ERBlh=round(2*eew/evv(2)); % number of samples for 2*eew on evv axiswe=hanning(lh)/sum(hanning(lh)); % Hanning window is used for smoothingbx=(1:length(evv)); % index for extractionhvv=228.8*(10.0.^(0.0467*evv)-1); % frequency axis represented in Hzhvv(1)=0; hvv(end)=fs/2; % safeguardip=iix-1;  % current framedda=[0;dd;fs/2]*f0(ii)/fr40; % anchor point for dip (Hz)gga=[0;gg;fs/2]*f0(ii)/fr40; % anchor point for peak (Hz)dfda=[dfd(1) dfd dfd(end)]; % dip level (dB)gfga=[gfg(1) gfg gfg(end)]; % peak level (dB)dfdap=10.0.^(dfda/10); % dip level (power)gfgap=10.0.^(gfga/10); % peak level (power)ape=interp1(HzToERBrate(gga),gfgap,evv); % Upper power envelope on ERBdpe=interp1(HzToERBrate(dda),dfdap,evv); % Upper power envelope on ERBapef=[ape(lh:-1:2) ape ape(end-1:-1:end-lh)]; % ape with mirrored endsdpef=[dpe(lh:-1:2) dpe dpe(end-1:-1:end-lh)]; % dpe with mirrored endsapefs=fftfilt(we,apef); % smoothed apedpefs=fftfilt(we,dpef); % smoothed dpeapefs=apefs(bx+lh-1+round(lh/2)); dpefs=dpefs(bx+lh-1+round(lh/2));apr=interp1(hvv,apefs,fxa); % smoothed ape on linear axisdpr=interp1(hvv,dpefs,fxa); % smoothed dpe on linear axis